<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pronounceable password generator</title>
    <script type="text/javascript">
        (function() {
            const byteArray = new Uint8Array(20);
            let byteArrayPos = 20;

            setTimeout(init, 50);

            function init() {
                document.querySelector('#generate').onclick = handleClick;
                handleClick();
                document.querySelector('body').style = '';
            }

            function handleClick() {
                const syllables = document.querySelector('#syllables')
                    .value
                    .split('\n')
                    .map(s => s.trim())
                    .filter(s => s !== '');

                const minLength = parseInt(document.querySelector('#minimumLength').value, 10);

                const words = Array.from({length: 20}, _ => buildWord(minLength, syllables));

                document.querySelector('#password').innerHTML = words.map(w => `<h3>${w}</h3>`).join('');
            }

            /***
             * build a word from random syllables
             * @param minimumLength {number} minimum size
             * @param syllables {Array<string>} possible syllables
             * @returns {string}
             */
            function buildWord(minimumLength, syllables) {
                let result = '';
                let randomSyllables = shuffle(syllables);
                let i = 0;
                while (result.length < minimumLength) {
                    if (i === randomSyllables.length){
                        throw new Error('Not enough syllables for length');
                    }
                    result += randomSyllables[i++];
                }
                return result;
            }

            /***
             * Return a new array in CSPR order
             * @param arr Array
             */
            function shuffle(arr) {
                return arr.sort((a, b) => randomNumber() - randomNumber());
            }

            /***
             * Get CSPR number
             * @returns {number}
             */
            function randomNumber() {
                if (byteArrayPos === 20) {
                    byteArrayPos = 0;
                    crypto.getRandomValues(byteArray);
                }

                return byteArray[byteArrayPos++];
            }
        }());
    </script>
</head>
<body style="display: none">
<h1>
    Pronounceable password generator
</h1>

<p>
    Simple tool to generate a password you can pronounce.  Since it runs in the browser, you don't need to trust
    any server-side tool, and since the code is pretty short, you don't have to trust me.  You do have to trust your
    browser's implementation of <a href="https://developer.mozilla.org/en-US/docs/Web/API/Crypto/getRandomValues">
    <tt>Crypto.getRandomValues()</tt></a> to shuffle the syllables properly though.
</p>

<p>
    The default syllable set is just a Japanese syllabary; feel free to sub in a different one if you want.  Or sub in
    whole words and make Diceware-style passwords.  It's the same thing, really.
</p>


<label for="minimumLength">Minimum length</label>
<br>
<input type="number" id="minimumLength" min="1" max="500" value="12">
<br><br>
<button type="button" id="generate">
    Generate passwords!
</button>

<div id="password">
    (password)
</div>

<label for="syllables">Syllables</label>
<br>
<textarea id="syllables" rows="20" cols="10">
a
i
u
e
o
ka
ki
ku
ke
ko
ga
gi
gu
ge
go
sa
shi
su
se
so
za
ji
zu
ze
zo
ta
chi
tsu
te
to
da
di
dzu
de
do
na
ni
nu
ne
no
ha
hi
fu
he
ho
fa
fi
fe
fo
ma
mi
mu
me
mo
ya
yu
yo
ra
ri
ru
re
ro
wa
wo
n
</textarea>
</body>
</html>
